---
import type { ImageMetadata } from 'astro';
import type { AstroComponentFactory } from 'astro/runtime/server/index.js';
import Button from '@/components/Button.astro';
import Badge from '@/components/Badge.astro';
import Image from 'astro/components/Image.astro';
import Vector from '@/assets/icons/Vector.astro';
import LogoGitHub from '@/assets/icons/LogoGitHub.astro';
import Pattern from '@/components/Pattern.astro';

interface Props {
	image: ImageMetadata;
	name: string;
	description: string;
	technologies?: Array<{
		name: string;
		icon?: string | 'javascript';
		styles?: string;
	}>;
	repository: string;
	demo: string;
}

const { image, name, description, technologies, repository, demo } = Astro.props;

// Import icons
import IconAstro from '@/assets/icons/IconAstro.astro';
import IconJavascript from '@/assets/icons/IconJavascript.astro';
import IconTailwind from '@/assets/icons/IconTailwindcss.astro';
import IconTypescript from '@/assets/icons/IconTypescript.astro';

// Crea un mapa de iconos
const iconMap: Record<string, AstroComponentFactory> = {
	astro: IconAstro,
	javascript: IconJavascript,
	tailwind: IconTailwind,
	typescript: IconTypescript,
};
---

<li class="project flex flex-col md:flex-row lg:flex-col xl:flex-row xl:items-center gap-8 group">
	<figure class="relative z-10 line-gradient w-full md:min-w-80 md:max-w-80 lg:min-w-150 lg:max-w-150 xl:min-w-80 xl:max-w-80 h-[210px] overflow-hidden pl-6 sm:pl-8 pt-8 rounded-xl">
		<Image src={image} alt={name} width={image.width} height={image.height} title={`Imagen ${name}`} loading="eager" class="w-full h-auto object-contain rounded-tl-xl group-hover:scale-105 transition-transform duration-300 ease-in-out" />

		<Pattern />
	</figure>
	<div>
		<h3 class="text-xl font-medium">{name}</h3>
		{
			technologies && (
				<div class="flex flex-wrap items-center gap-2 mt-4 mb-5">
					{technologies.map(({ name, icon, styles }) => {
						const IconComponent = iconMap[icon || 'javascript'];
						return (
							<Badge className={`user-select-none ${styles}`}>
								{IconComponent && <IconComponent width={12} height={12} class="inline-flex" />}
								{name}
							</Badge>
						);
					})}
				</div>
			)
		}

		<p class="mt-2 mb-6">{description}</p>
		<div class="flex flex-wrap gap-2 lg:gap-4">
			<Button href={repository} variants="transparent" size="sm" attr={{ target: '_blank', rel: 'noopener noreferrer', title: 'Ir al repositorio del proyecto' }}>
				<LogoGitHub width={16} height={16} />
				<span>Repositorio</span>
			</Button>
			<Button href={demo} variants="normal" size="sm" attr={{ target: '_blank', rel: 'noopener noreferrer', title: 'Ver la vista previa del proyecto' }}>
				<Vector width={16} height={16} />
				<span>Vista previa</span>
			</Button>
		</div>
	</div>
</li>

<style>
	.line-gradient::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		z-index: -11;
		background-color: var(--color-secondary);
		transition: background-color 0.5s ease-in-out;
	}
</style>
